var _classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_get=function t(e,i,n){var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in r)return r.value;var o=r.get;return void 0===o?void 0:o.call(n)},_inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3"),require("koto"),require("KotoTooltip")):"function"==typeof define&&define.amd?define(["d3","koto","KotoTooltip"],e):t.KotoIcicle=e(t.d3,t.koto,t.KotoTooltip)}(this,function(t,e,i){"use strict";function n(){function e(t){return function(e){return e[t]}}function i(n,u,c){if(c>=s)return a?a.call(o,u):r?u.sort(r):u;for(var p,d,f,g,h,m=-1,y=u.length,E=e(c++),x=t.map({});++m<y;)d=1===c?u[m].filter(l):u[m],h=x.get(p=E(d)),u[m].length>c&&(h?h.push(d):x.set(p,[d]));return n?(d=n(),g=function(t){return t.size()},f=function(t,e){d.set(t,i(n,e,c))}):(d={},g=function(t){return Object.keys(t).length},f=function(t,e){d[t]=i(n,e,c)}),x.forEach(f),g(d)?d:u}function n(t,e){if(e>=s||e>t.length-1)return t;var i=[],r=u[e++];return t.forEach(function(t,r){i.push({name:t,children:n(r,e)})}),r?i.sort(function(t,e){return r(t.name,e.name)}):i}var r,a,o={},u=[],s=0,l=function(t){return null!==t};return o.map=function(t,e){return i(e,t,0)},o.entries=function(e){return n(i(t.map,e,0),0)},o.maxLength=function(t){return s=t-2,o},o.filter=function(t){return l=t,o},o.sortKeys=function(t,e){return e=e||s,u[e]=t,o},o.sortValues=function(t){return r=t,o},o.rollup=function(t){return a=t,o},o}var r=[{name:"height",description:"The height of the chart.",value:700,type:"number",units:"px",category:"Size",getter:function(){return this.value},setter:function(t){return t}},{name:"width",description:"The widthj of the chart.",value:900,units:"px",type:"number",category:"Size"},{name:"transitionDuration",description:"How long should it take to animate on click.",value:750,units:"ms",type:"number",category:"Animation"},{name:"introDuration",description:"How long should it take to animate in.",value:2e3,units:"ms",type:"number",category:"Animation"},{name:"colorRange",value:["#BBE491","#FB8D34","#E45621","#73B0D7"],description:"colors for categories",type:"colorArray",category:"Color"}],a=function(e){function a(e){function n(t){c.x.domain([t.x,t.x+t.dx]),c.y.domain([t.y,1]).range([t.y?20:0,c.config("height")]),c._group.selectAll("rect").transition().duration(c.config("transitionDuration")).attr("x",function(t){return c.x(t.x)}).attr("y",function(t){return c.y(t.y)}).attr("width",function(t){return c.x(t.x+t.dx)-c.x(t.x)}).attr("height",function(t){return c.y(t.y+t.dy)-c.y(t.y)}),c._targetData&&c._group.selectAll("path").transition().duration(c.config("transitionDuration")).attr("transform",function(t){var e=c.x(t.x)+15,i=c.y(t.y)+15;return"translate("+e+","+i+")"}),c._group.selectAll("text").transition().duration(c.config("transitionDuration")).attr("x",function(t){return c.x(t.x)}).attr("y",function(t){return c.y(t.y)}).style("opacity",function(t){return t.textLength+12<c.x(t.x+t.dx)-c.x(t.x)?1:0})}function o(t,e){return u(t,e)||s(t,e)}function u(t,e){for(var i=!0;i;){i=!1;var n=t,r=e;if(n===r)return!0;if(!n.parent)return!1;t=n.parent,e=r,i=!0}}function s(t,e){var i;if(t===e)return!0;if(!t.children)return!1;for(i=0;i<t.children.length;i++)if(s(t.children[i],e))return!0;return!1}function l(t,e){for(var i=!0;i;){i=!1;var n=t,r=e;if(!n.parent)return n.name;if(n.parent.name===r)return n.name;t=n.parent,e=r,i=!0}}_classCallCheck(this,a),_get(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,e);var c=this;r.forEach(function(t){c.configs.set(t.name,t)}),this.accessor("name",function(t){return t[t.length-2]});var p=t.format("%"),d=t.format("+%");this.x=t.scale.linear(),this.y=t.scale.linear(),this.color=t.scale.ordinal(),this.partition=t.layout.partition().value(function(t){return t[t.length-1]}),this._group=this.base.append("g"),this._tooltip=new i(this.base.append("g")),this._tooltip.config({opacity:1,format:"textRectText"}),this._tooltipValue=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltipRect=this._tooltip._appends.append("rect"),this._tooltipLabel=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltip.trigger("draw"),this._tooltip.trigger("remove");var f=this.layer("icicle",this._group,{dataBind:function(t){var e=c.partition(t[0]);if(c._targetData)for(var i=c.partition(c._targetData[0]),n=0;n<e.length;n++)e[n].target=i[n].value;return this.selectAll("g").data(e)},insert:function(){return this.append("g").on("click",n).on("mouseover",function(t){c._group.selectAll("rect").filter(function(e){t.name?t.name:t[t.length-2];return!o(t,e)}).style("fill","#e3e3e3"),c._tooltipValue.text(t.name?t.name:c.accessor("name")(t)),c._tooltipRect.style("fill","#000"),c._tooltipLabel.text(p(t.value)),c._targetData&&(c._tooltipRect2.style("fill","#000"),c._tooltipLabel2.text(d(t.value-t.target))),c._tooltip.trigger("draw")}).on("mousemove",function(){var e=t.mouse(c.base.node());c._tooltip.trigger("moveTo",{x:e[0],y:e[1]},null,c.config("width"),c.config("height"))}).on("mouseout",function(t){c._group.selectAll("rect").style("fill",function(t){return c.color(t.base)}),c._tooltip.trigger("remove")})}});f.on("enter",function(){return this.append("rect").style("stroke","#fff"),c._targetData&&this.append("path"),this.append("text").style("pointer-events","none"),this}).on("merge",function(){this.select("rect").attr("x",function(t){return c.x(t.x)}).attr("y",function(t){return c.y(t.y)}).attr("width",function(t){return c.x(t.dx)}).attr("height",0).style("fill",function(t){return t.base=l(t,c.rootName),c.color(t.base)}),c._targetData&&this.select("path").style("fill","#555").style("opacity",0).attr({d:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var i=t.svg.symbol(),n=e.value>e.target?i.type("triangle-up"):e.value<e.target?i.type("triangle-down"):i.type("triangle-down");return n()}),transform:function(t){var e=c.x(t.x)+15,i=c.y(t.y)+15;return"translate("+e+","+i+")"}}),this.select("text").text(function(t){return t.name?t.name:t[t.length-2]}).attr("x",function(t){return c.x(t.x)}).attr("dx",c._targetData?25:5).attr("y",function(t){return c.y(t.y)}).attr("dy",16).style("alignment-baseline","middle").style("fill","#555").style("font-family","Open Sans").style("opacity",0)}).on("merge:transition",function(){var t=c.config("introDuration"),e=t/(c.max-1);return this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("rect").attr("height",function(t){return c.y(t.dy)}),c._targetData&&this.delay(t).selectAll("path").style("opacity",function(t){var e=t.value>t.target||t.value<t.target,i=c.x(t.dx)>25;return e&&i?1:0}),this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("text").style("opacity",function(t){return t.textLength=this.getComputedTextLength(),t.textLength+30<c.x(t.dx)?1:0}),this})}return _inherits(a,e),_createClass(a,[{key:"transform",value:function(e){return this.max=t.max(e,function(t){return t.length}),n().maxLength(this.max).entries(e)}},{key:"targetData",value:function(t){return this._targetData=n().maxLength(this.max).entries(t),this._tooltipRect2=this._tooltip._appends.append("rect"),this._tooltipLabel2=this._tooltip._appends.append("text").style("font-family","Open Sans"),this}},{key:"preDraw",value:function(t){this.x.range([0,this.config("width")]),this.y.range([0,this.config("height")]),this.rootName=t[0].name;var e=t[0].children.map(function(t){return t.name});e.push(this.rootName),this.color.range(this.config("colorRange")).domain(e)}}]),a}(e.Base);e.Icicle=a;var o=e.Icicle;return o});
//# sourceMappingURL=chart.min.js.map