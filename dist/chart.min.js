function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3"),require("koto"),require("koto-tooltip")):"function"==typeof define&&define.amd?define(["d3","koto","koto-tooltip"],e):t.KotoIcicle=e(t.d3,t.Koto,t.KotoTooltip)}(this,function(t,e,i){"use strict";function n(){function e(t){return function(e){return e[t]}}function i(n,u,c){if(c>=s)return a?a.call(o,u):r?u.sort(r):u;for(var p,d,f,h,g,m=-1,y=u.length,E=e(c++),x=t.map({});++m<y;)d=1===c?u[m].filter(l):u[m],g=x.get(p=E(d)),u[m].length>c&&(g?g.push(d):x.set(p,[d]));return n?(d=n(),h=function(t){return t.size()},f=function(t,e){d.set(t,i(n,e,c))}):(d={},h=function(t){return Object.keys(t).length},f=function(t,e){d[t]=i(n,e,c)}),x.forEach(f),h(d)?d:u}function n(t,e){if(e>=s||e>t.length-1)return t;var i=[],r=u[e++];return t.forEach(function(t,r){i.push({name:t,children:n(r,e)})}),r?i.sort(function(t,e){return r(t.name,e.name)}):i}var r,a,o={},u=[],s=0,l=function(t){return null!==t};return o.map=function(t,e){return i(e,t,0)},o.entries=function(e){return n(i(t.map,e,0),0)},o.maxLength=function(t){return s=t-2,o},o.filter=function(t){return l=t,o},o.sortKeys=function(t,e){return e=e||s,u[e]=t,o},o.sortValues=function(t){return r=t,o},o.rollup=function(t){return a=t,o},o}var r=[{name:"height",description:"The height of the chart.",value:700,type:"number",units:"px",category:"Size",getter:function(){return this.value},setter:function(t){return t}},{name:"width",description:"The widthj of the chart.",value:900,units:"px",type:"number",category:"Size"},{name:"transitionDuration",description:"How long should it take to animate on click.",value:750,units:"ms",type:"number",category:"Animation"},{name:"introDuration",description:"How long should it take to animate in.",value:2e3,units:"ms",type:"number",category:"Animation"},{name:"colorRange",value:["#BBE491","#FB8D34","#E45621","#73B0D7"],description:"colors for categories",type:"colorArray",category:"Color"}],a=function(e){function a(n){function o(t){p.x.domain([t.x,t.x+t.dx]),p.y.domain([t.y,1]).range([t.y?20:0,p.config("height")]),p._group.selectAll("rect").transition().duration(p.config("transitionDuration")).attr("x",function(t){return p.x(t.x)}).attr("y",function(t){return p.y(t.y)}).attr("width",function(t){return p.x(t.x+t.dx)-p.x(t.x)}).attr("height",function(t){return p.y(t.y+t.dy)-p.y(t.y)}),p._targetData&&p._group.selectAll("path").transition().duration(p.config("transitionDuration")).attr("transform",function(t){var e=p.x(t.x)+15,i=p.y(t.y)+15;return"translate("+e+","+i+")"}),p._group.selectAll("text").transition().duration(p.config("transitionDuration")).attr("x",function(t){return p.x(t.x)}).attr("y",function(t){return p.y(t.y)}).style("opacity",function(t){return t.textLength+12<p.x(t.x+t.dx)-p.x(t.x)?1:0})}function u(t,e){return s(t,e)||l(t,e)}function s(t,e){for(var i=!0;i;){var n=t,r=e;if(i=!1,n===r)return!0;if(!n.parent)return!1;t=n.parent,e=r,i=!0}}function l(t,e){var i;if(t===e)return!0;if(!t.children)return!1;for(i=0;i<t.children.length;i++)if(l(t.children[i],e))return!0;return!1}function c(t,e){for(var i=!0;i;){var n=t,r=e;if(i=!1,!n.parent)return n.name;if(n.parent.name===r)return n.name;t=n.parent,e=r,i=!0}}_classCallCheck(this,a),e.call(this,n);var p=this;r.forEach(function(t){p.configs.set(t.name,t)}),this.accessor("name",function(t){return t[t.length-2]});var d=t.format("%"),f=t.format("+%");this.x=t.scale.linear(),this.y=t.scale.linear(),this.color=t.scale.ordinal(),this.partition=t.layout.partition().value(function(t){return t[t.length-1]}),this._group=this.base.append("g"),this._tooltip=new i(this.base.append("g")),this._tooltip.config({opacity:1,format:"textRectText"}),this._tooltipValue=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltipRect=this._tooltip._appends.append("rect"),this._tooltipLabel=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltip.trigger("draw"),this._tooltip.trigger("remove");var h=this.layer("icicle",this._group,{dataBind:function(t){var e=p.partition(t[0]);if(p._targetData)for(var i=p.partition(p._targetData[0]),n=0;n<e.length;n++)e[n].target=i[n].value;return this.selectAll("g").data(e)},insert:function(){return this.append("g").on("click",o).on("mouseover",function(t){p._group.selectAll("rect").filter(function(e){t.name?t.name:t[t.length-2];return!u(t,e)}).style("fill","#e3e3e3"),p._tooltipValue.text(t.name?t.name:p.accessor("name")(t)),p._tooltipRect.style("fill","#000"),p._tooltipLabel.text(d(t.value)),p._targetData&&(p._tooltipRect2.style("fill","#000"),p._tooltipLabel2.text(f(t.value-t.target))),p._tooltip.trigger("draw")}).on("mousemove",function(){var e=t.mouse(p.base.node());p._tooltip.trigger("moveTo",{x:e[0],y:e[1]},null,p.config("width"),p.config("height"))}).on("mouseout",function(t){p._group.selectAll("rect").style("fill",function(t){return p.color(t.base)}),p._tooltip.trigger("remove")})}});h.on("enter",function(){return this.append("rect").style("stroke","#fff"),p._targetData&&this.append("path"),this.append("text").style("pointer-events","none"),this}).on("merge",function(){this.select("rect").attr("x",function(t){return p.x(t.x)}).attr("y",function(t){return p.y(t.y)}).attr("width",function(t){return p.x(t.dx)}).attr("height",0).style("fill",function(t){return t.base=c(t,p.rootName),p.color(t.base)}),p._targetData&&this.select("path").style("fill","#555").style("opacity",0).attr({d:function(e){var i=t.svg.symbol(),n=e.value>e.target?i.type("triangle-up"):e.value<e.target?i.type("triangle-down"):i.type("triangle-down");return n()},transform:function(t){var e=p.x(t.x)+15,i=p.y(t.y)+15;return"translate("+e+","+i+")"}}),this.select("text").text(function(t){return t.name?t.name:t[t.length-2]}).attr("x",function(t){return p.x(t.x)}).attr("dx",p._targetData?25:5).attr("y",function(t){return p.y(t.y)}).attr("dy",16).style("alignment-baseline","middle").style("fill","#555").style("font-family","Open Sans").style("opacity",0)}).on("merge:transition",function(){var t=p.config("introDuration"),e=t/(p.max-1);return this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("rect").attr("height",function(t){return p.y(t.dy)}),p._targetData&&this.delay(t).selectAll("path").style("opacity",function(t){var e=t.value>t.target||t.value<t.target,i=p.x(t.dx)>25;return e&&i?1:0}),this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("text").style("opacity",function(t){return t.textLength=this.getComputedTextLength(),t.textLength+30<p.x(t.dx)?1:0}),this})}return _inherits(a,e),a.prototype.transform=function(e){return this.max=t.max(e,function(t){return t.length}),n().maxLength(this.max).entries(e)},a.prototype.targetData=function(t){return this._targetData=n().maxLength(this.max).entries(t),this._tooltipRect2=this._tooltip._appends.append("rect"),this._tooltipLabel2=this._tooltip._appends.append("text").style("font-family","Open Sans"),this},a.prototype.preDraw=function(t){this.x.range([0,this.config("width")]),this.y.range([0,this.config("height")]),this.rootName=t[0].name;var e=t[0].children.map(function(t){return t.name});e.push(this.rootName),this.color.range(this.config("colorRange")).domain(e)},a}(e),o=a;return o});
//# sourceMappingURL=chart.min.js.map