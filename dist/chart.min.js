var _classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),_get=function t(e,i,o){var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,o)}if("value"in n)return n.value;var r=n.get;return void 0===r?void 0:r.call(o)},_inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3"),require("koto")):"function"==typeof define&&define.amd?define(["d3","koto"],e):t.koto.Icicle=e(t.d3,t.koto)}(this,function(t,e){"use strict";function i(){function e(t){return function(e){return e[t]}}function i(o,s,l){if(l>=c)return a?a.call(r,s):n?s.sort(n):s;for(var h,p,g,d,f,m=-1,_=s.length,x=e(l++),y=t.map({});++m<_;)p=1===l?s[m].filter(u):s[m],f=y.get(h=x(p)),s[m].length>l&&(f?f.push(p):y.set(h,[p]));return o?(p=o(),d=function(t){return t.size()},g=function(t,e){p.set(t,i(o,e,l))}):(p={},d=function(t){return Object.keys(t).length},g=function(t,e){p[t]=i(o,e,l)}),y.forEach(g),d(p)?p:s}function o(t,e){if(e>=c||e>t.length-1)return t;var i=[],n=s[e++];return t.forEach(function(t,n){i.push({name:t,children:o(n,e)})}),n?i.sort(function(t,e){return n(t.name,e.name)}):i}var n,a,r={},s=[],c=0,u=function(t){return null!==t};return r.map=function(t,e){return i(e,t,0)},r.entries=function(e){return o(i(t.map,e,0),0)},r.maxLength=function(t){return c=t-2,r},r.filter=function(t){return u=t,r},r.sortKeys=function(t,e){return e=e||c,s[e]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return a=t,r},r}var o=function(e){function i(e){function o(t,e){var i,o,n,a;return n=m(t.hittingRight,t.hittingLeft,t.offsetX+B.config("caretSize"),"width",e),a=t.topY,o=B._topPath.translate,i=0!==B._moveX?_("_topPath","x"):B._topPath.path,{translateX:n,translateY:a,translate:o,path:i}}function n(t,e){var i,o,n,a;return a=m(t.hittingBottom,t.hittingTop,t.centerY-B.config("padding"),"height",e),n=t.rightX,o=B._rightPath.translate,i=0!==B._moveY?_("_rightPath","y"):B._rightPath.path,{translateX:n,translateY:a,translate:o,path:i}}function a(t,e){var i,o,n,a;return n=m(t.hittingRight,t.hittingLeft,t.offsetX+B.config("caretSize")/2,"width",e),a=t.bottomY+B.config("padding")+5,o=B._bottomPath.translate,i=0!==B._moveX?_("_bottomPath","x"):B._bottomPath.path,{translateX:n,translateY:a,translate:o,path:i}}function r(t,e){var i,o,n,a;return a=m(t.hittingBottom,t.hittingTop,t.centerY-B.config("padding"),"height",e),n=t.leftX,o=B._leftPath.translate,i=0!==B._moveY?_("_leftPath","y"):B._leftPath.path,{translateX:n,translateY:a,translate:o,path:i}}function s(t,e,i,s){var c;switch(t){case"top":c=o(e,s);break;case"right":c=n(e,i);break;case"bottom":c=a(e,s);break;case"left":c=r(e,i)}return c}function c(t){var e="top";return!t.hittingRight&&!t.hittingLeft||t.closeToTop?(t.hittingRight||t.hittingLeft)&&t.closeToTop?e="bottom":t.hittingTop&&t.closeToRight?e="left":t.hittingTop&&t.closeToLeft?e="right":!t.hittingRight&&t.closeToRight?e="left":!t.hittingLeft&&t.closeToLeft?e="right":t.closeToBottom&&t.closeToTop?e="top":t.closeToTop&&(e="bottom"):e="top",e}function u(t,e,i){var o=B._gBBox,n=i.y-B._baseGroupBBox.height,a=i.x-B._baseGroupBBox.width/2,r=B._caretWidth,s=n-r,c=i.y+r,u=i.y-o.height/2,l=i.x-B._baseGroupBBox.width-B.config("caretSize"),h=i.x+r+5,p=i.x+B._baseGroupBBox.width/2>=t,g=i.x-B._baseGroupBBox.width/2<=0,d=i.y-B._baseGroupBBox.height-r-3<=0,f=i.y+B._baseGroupBBox.height>e,m=p&&i.x-B._baseGroupBBox.width-r<=0,_=g&&i.x+B._baseGroupBBox.width+r>=t,x=(p||g)&&i.y-B._baseGroupBBox.height/2<=0,y=(p||g)&&i.y+B._baseGroupBBox.height/2>=e;return{offsetX:a,topY:s,bottomY:c,centerY:u,leftX:l,rightX:h,closeToRight:p,closeToLeft:g,closeToTop:d,closeToBottom:f,hittingRight:m,hittingLeft:_,hittingTop:x,hittingBottom:y}}function l(t){B._baseGroupBBox.height="top"===t||"bottom"===t?B._gBBox.height+2*B.config("padding")+B.config("caretSize")+6:B._gBBox.height+2*B.config("padding")+6,B._baseGroupBBox.width="top"===t||"bottom"===t?B._gBBox.width+2*B.config("padding")+6:B._gBBox.width+2*B.config("padding")+B.config("caretSize")+6}function h(t){for(var e=!0,i=0;i<t.node().childNodes.length;i++){var o=t.node().childNodes[i].nodeName;if(e=i%2===0&&"text"===o?!0:"rect"===o,!e)break}return e}function p(t){var e=5,i=0,o={x:0,y:0,height:0,width:0};t.select("rect").attr("height",0),o=t.node().getBBox();for(var n=0;n<t.node().childNodes.length;n++){var a=t.node().childNodes[n];if(n%2===0){{t.select("text:nth-child("+(n+1)+")").attr({dy:function(){return f(this)},x:i+e*n+1,y:o.height/2})}i+=a.getBBox().width}else t.select("rect:nth-child("+(n+1)+")").attr({x:i+e*n,y:0,width:1,height:o.height})}t.selectAll("tspan").attr({transform:function(){return"translate(0, "+f(this)+")"},y:o.height/2})}function g(){B._baseGroupBBox=v(B._baseGroup.node().getBBox()),B._baseGroupBBox.height=B._baseGroupBBox.height-B._caretWidth+3}function d(t,e){void 0!==t&&void 0!==e?B._gBBox={height:t,width:e}:B._gBBox=B._appends.node().getBBox()}function f(e){return.35*parseInt(t.select(e).style("font-size"),10)}function m(t,e,i,o,n){var a;return a=t?n-B._baseGroupBBox[o]+M:e?M:i}function _(t,e){var i,o;return o="y"===e?B[t].caretX+" "+(B[t].caretY-B._moveY):B[t].caretX+B._moveX+" "+B[t].caretY,i=B[t].path.match(/Z m (.*?) l/),B[t].path=B[t].path.replace(i[1],o),B[t].path}function x(t){var e,i,o,n,a=t.container,r=t.point,s=a.width-r.x,c=r.y,u=2*M;n=B._gBBox.height,o=B._gBBox.width;var l;t.left||t.right?(t.left&&(e=a.width-B._baseGroupBBox.width/2,B._moveX=e-s,o/2+B.config("caretSize")<=B._moveX&&(B._moveX=-(o/2+B.config("caretSize")))),t.right&&(e=B._baseGroupBBox.width/2,B._moveX=e-s,-(o/2+B.config("caretSize"))>=B._moveX&&(B._moveX=-(o/2+B.config("caretSize"))))):t.top||t.bottom?(t.top&&(i=B._baseGroupBBox.height/2,B._moveY=i-c,l=n/2+B.config("caretSize")-u,l<=B._moveY&&(B._moveY=l)),t.bottom&&(i=a.height-B._baseGroupBBox.height/2,B._moveY=i-c,l=-(n/2-B.config("caretSize"))-u,l>=B._moveY&&(B._moveY=l))):(B._moveX=0,B._moveY=0)}function y(){var t=B._gBBox.width+2*B.config("padding"),e=B._gBBox.height+2*B.config("padding"),i=B.config("caretSize"),o=e/2+B.config("caretSize")+M;B._topPath={translate:"translate("+t/2+","+(e+i+M)+")",caretX:t/2-i,caretY:e+2*M},B._topPath.path="m -"+t/2+" -"+(e+i+2*M)+" h "+t+" c 1.7 0 "+M+" 1.3 "+M+" "+M+" v "+e+" c 0 1.7 -1.3 "+M+" -"+M+" "+M+" h -"+t+" c -1.7 0 -"+M+" -1.3 -"+M+" -"+M+" v -"+e+" c 0 -1.7 1.3 -"+M+" "+M+" -"+M+" Z m "+B._topPath.caretX+" "+B._topPath.caretY+" l "+i+" "+i+" l "+i+" -"+i,B._bottomPath={translate:"translate("+t/2+","+(-i+M/2)+")",caretX:t/2-i,caretY:0},B._bottomPath.path="m -"+t/2+" 0 h "+t+" c 1.7 0 "+M+" 1.3 "+M+" "+M+" v "+e+" c 0 1.7 -1.3 "+M+" -"+M+" "+M+" h -"+t+" c -1.7 0 -"+M+" -1.3 -"+M+" -"+M+" v -"+e+" c 0 -1.7 1.3 -"+M+" "+M+" -"+M+" Z m "+B._bottomPath.caretX+" "+B._bottomPath.caretY+" l "+i+" -"+i+" l "+i+" "+i,B._leftPath={translate:"translate("+(t+i+M)+","+e/2+")",caretX:t+M,caretY:o},B._leftPath.path="m -"+(t+i+M)+" "+-(e/2+M)+" h "+t+" c 1.7 0 "+M+" 1.3 "+M+" "+M+" v "+e+" c 0 1.7 -1.3 "+M+" -"+M+" "+M+" h -"+t+" c -1.7 0 -"+M+" -1.3 -"+M+" -"+M+" v -"+e+" c 0 -1.7 1.3 -"+M+" "+M+" -"+M+" Z m "+B._leftPath.caretX+" "+B._leftPath.caretY+" l "+i+" -"+i+" l -"+i+" -"+i,B._rightPath={translate:"translate("+-(i+M)+","+e/2+")",caretX:-M,caretY:o},B._rightPath.path="m "+(i+M)+" "+-(e/2+M)+" h "+t+" c 1.7 0 "+M+" 1.3 "+M+" "+M+" v "+e+" c 0 1.7 -1.3 "+M+" -"+M+" "+M+" h -"+t+" c -1.7 0 -"+M+" -1.3 -"+M+" -"+M+" v -"+e+" c 0 -1.7 1.3 -"+M+" "+M+" -"+M+" Z m "+B._rightPath.caretX+" "+B._rightPath.caretY+" l -"+i+" -"+i+" l "+i+" -"+i+" Z"}function v(t){return{x:t.x,y:t.y,width:t.width,height:t.height}}_classCallCheck(this,i),_get(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,e);var B=this,b={container:this.base,opacity:0,padding:7,caretSize:5,stationary:!1,maxWidth:200,format:"default",tooltipBackgroundColor:"#fff"};for(var E in b)this.configs.set(E,{value:b[E]});var C={"default":function(t){},text:function(t){if(1===t[0].length&&"text"===t.node().childNodes[0].nodeName){var e=t.node().childNodes[0].getBBox();t.select("text").attr({dy:function(){return f(this)},y:e.height/2}),t.selectAll("tspan").attr({dy:function(){return f(this)},y:e.height/2})}},textBlock:function(e){var i=e.select("text"),o=i.node().getBoundingClientRect().height;t.domoStrings.wrapText(i,B.config("maxWidth")),e.select("text").attr({y:o-o/4})},textRectText:function(t){t.node().childNodes.length%2!==0&&h(t)&&p(t)}},M=3;this._baseGroup=this.base.append("g").attr("transform","translate(0, 0)").style("pointer-events","none"),B._parent=B._baseGroup.node().parentNode,this._baseGroup.append("path").attr("class","toolTipPath").style("opacity",.9),this._appends=this._baseGroup.append("g"),B._drawn=!1,B._moveX=void 0,B._moveY=void 0,this.on("remove",function(){B._drawn=!1,t.select("html").node().contains(B._baseGroup.node())&&B._parent.removeChild(B._baseGroup.node())}),this.on("draw",function(t,e){B._parent.appendChild(B._baseGroup.node()),B._container=B.config("container"),B._caretWidth=2*B.config("caretSize"),B._containerBBox=B.config("container").node().getBoundingClientRect(),B._baseGroup.select(".toolTipPath").style("fill",B.config("tooltipBackgroundColor")),B._appends.attr("transform","translate("+B.config("padding")+", "+B.config("padding")+")"),C[B.config("format")](B._appends),d(e,t),g(),y(),B._baseGroup.select(".toolTipPath").attr({transform:B._topPath.translate,d:B._topPath.path}),B._drawn=!0}),this.on("moveTo",function(t,e,i,o){if(l(e),B._drawn){var n=i?i:B._containerBBox.width,a=o?o:B._containerBBox.height,r=B._baseGroup,h=u(n,a,t);e||(e=c(h)),x({left:h.hittingLeft,right:h.hittingRight,top:h.hittingTop,bottom:h.hittingBottom,container:{height:a,width:n},point:t});var p=s(e,h,a,n);r.attr("transform","translate("+p.translateX+","+p.translateY+")"),r.select(".toolTipPath").attr({transform:p.translate,d:p.path})}})}return _inherits(i,e),_createClass(i,[{key:"preDraw",value:function(){this._container=this.config("container")}}]),i}(e.Base),n=o,a=i,r=function(e){function i(e){function o(t){u.x.domain([t.x,t.x+t.dx]),u.y.domain([t.y,1]).range([t.y?20:0,u.config("height")]),u._group.selectAll("rect").transition().duration(u.config("transitionDuration")).attr("x",function(t){return u.x(t.x)}).attr("y",function(t){return u.y(t.y)}).attr("width",function(t){return u.x(t.x+t.dx)-u.x(t.x)}).attr("height",function(t){return u.y(t.y+t.dy)-u.y(t.y)}),u._targetData&&u._group.selectAll("path").transition().duration(u.config("transitionDuration")).attr("transform",function(t){var e=u.x(t.x)+15,i=u.y(t.y)+15;return"translate("+e+","+i+")"}),u._group.selectAll("text").transition().duration(u.config("transitionDuration")).attr("x",function(t){return u.x(t.x)}).attr("y",function(t){return u.y(t.y)}).style("opacity",function(t){return t.textLength+12<u.x(t.x+t.dx)-u.x(t.x)?1:0})}function a(t,e){return r(t,e)||s(t,e)}function r(t,e){for(var i=!0;i;){i=!1;var o=t,n=e;if(o===n)return!0;if(!o.parent)return!1;t=o.parent,e=n,i=!0}}function s(t,e){var i;if(t===e)return!0;if(!t.children)return!1;for(i=0;i<t.children.length;i++)if(s(t.children[i],e))return!0;return!1}function c(t,e){for(var i=!0;i;){i=!1;var o=t,n=e;if(!o.parent)return o.name;if(o.parent.name===n)return o.name;t=o.parent,e=n,i=!0}}_classCallCheck(this,i),_get(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,e);var u=this;[{name:"height",description:"The height of the chart.",value:700,type:"number",units:"px",category:"Size",getter:function(){return console.log("getter"),this.value},setter:function(t){return console.log("setter"),t}},{name:"width",description:"The widthj of the chart.",value:900,units:"px",type:"number",category:"Size"},{name:"transitionDuration",description:"How long should it take to animate on click.",value:750,units:"ms",type:"number",category:"Animation"},{name:"introDuration",description:"How long should it take to animate in.",value:2e3,units:"ms",type:"number",category:"Animation"},{name:"colorRange",value:["#BBE491","#FB8D34","#E45621","#73B0D7"],description:"colors for categories",type:"colorArray",category:"Color"}].forEach(function(t){u.configs.set(t.name,t)}),this.accessor("name",function(t){return t[t.length-2]});var l=t.format("%"),h=t.format("+%");this.x=t.scale.linear(),this.y=t.scale.linear(),this.color=t.scale.ordinal(),this.partition=t.layout.partition().value(function(t){return t[t.length-1]}),this._group=this.base.append("g"),this._tooltip=new n(this.base.append("g")),this._tooltip.config({opacity:1,format:"textRectText"}),this._tooltipValue=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltipRect=this._tooltip._appends.append("rect"),this._tooltipLabel=this._tooltip._appends.append("text").style("font-family","Open Sans"),this._tooltip.trigger("draw"),this._tooltip.trigger("remove");var p=this.layer("icicle",this._group,{dataBind:function(t){var e=u.partition(t[0]);if(u._targetData)for(var i=u.partition(u._targetData[0]),o=0;o<e.length;o++)e[o].target=i[o].value;return this.selectAll("g").data(e)},insert:function(){return this.append("g").on("click",o).on("mouseover",function(t){u._group.selectAll("rect").filter(function(e){t.name?t.name:t[t.length-2];return!a(t,e)}).style("fill","#e3e3e3"),u._tooltipValue.text(t.name?t.name:u.accessor("name")(t)),u._tooltipRect.style("fill","#000"),u._tooltipLabel.text(l(t.value)),u._targetData&&(u._tooltipRect2.style("fill","#000"),u._tooltipLabel2.text(h(t.value-t.target))),u._tooltip.trigger("draw")}).on("mousemove",function(){var e=t.mouse(u.base.node());u._tooltip.trigger("moveTo",{x:e[0],y:e[1]},null,u.config("width"),u.config("height"))}).on("mouseout",function(t){u._group.selectAll("rect").style("fill",function(t){return u.color(t.base)}),u._tooltip.trigger("remove")})}});p.on("enter",function(){return this.append("rect").style("stroke","#fff"),u._targetData&&this.append("path"),this.append("text").style("pointer-events","none"),this}).on("merge",function(){this.select("rect").attr("x",function(t){return u.x(t.x)}).attr("y",function(t){return u.y(t.y)}).attr("width",function(t){return u.x(t.dx)}).attr("height",0).style("fill",function(t){return t.base=c(t,u.rootName),u.color(t.base)}),u._targetData&&this.select("path").style("fill","#555").style("opacity",0).attr({d:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var i=t.svg.symbol(),o=i.type(e.value>e.target?"triangle-up":e.value<e.target?"triangle-down":"triangle-down");return o()}),transform:function(t){var e=u.x(t.x)+15,i=u.y(t.y)+15;return"translate("+e+","+i+")"}}),this.select("text").text(function(t){return t.name?t.name:t[t.length-2]}).attr("x",function(t){return u.x(t.x)}).attr("dx",u._targetData?25:5).attr("y",function(t){return u.y(t.y)}).attr("dy",16).style("alignment-baseline","middle").style("fill","#555").style("font-family","Open Sans").style("opacity",0)}).on("merge:transition",function(){var t=u.config("introDuration"),e=t/(u.max-1);return this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("rect").attr("height",function(t){return u.y(t.dy)}),u._targetData&&this.delay(t).selectAll("path").style("opacity",function(t){var e=t.value>t.target||t.value<t.target,i=u.x(t.dx)>25;return e&&i?1:0}),this.duration(e).ease("linear").delay(function(t){return t.depth*e}).select("text").style("opacity",function(t){return t.textLength=this.getComputedTextLength(),t.textLength+30<u.x(t.dx)?1:0}),this})}return _inherits(i,e),_createClass(i,[{key:"transform",value:function(e){return this.max=t.max(e,function(t){return t.length}),a().maxLength(this.max).entries(e)}},{key:"targetData",value:function(t){return this._targetData=a().maxLength(this.max).entries(t),this._tooltipRect2=this._tooltip._appends.append("rect"),this._tooltipLabel2=this._tooltip._appends.append("text").style("font-family","Open Sans"),this}},{key:"preDraw",value:function(t){this.x.range([0,this.config("width")]),this.y.range([0,this.config("height")]),this.rootName=t[0].name;var e=t[0].children.map(function(t){return t.name});e.push(this.rootName),this.color.range(this.config("colorRange")).domain(e)}}]),i}(e.Base);e.Icicle=r;var s=e.Icicle;return s});
//# sourceMappingURL=chart.min.js.map